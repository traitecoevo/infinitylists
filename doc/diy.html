<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Create your own infinitylists</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Create your own infinitylists</h1>



<p>One major benefit of infinitylists using a Living Atlas node is that
is gives users the ability to create their own version of infinitylists
for whichever Living Atlas you would like to use. Unfortunately, there
are some slight inconsistencies in data coverage and naming between
Living Atlas data providers. This makes creating your own infinitylists
not an entirely straightforward process but I hope this article will be
able to give you some guidance.</p>
<p>Here, I will walk through the process on how to adapt the source code
of infinitylists so you can create your own version of infinitylists for
any country and taxa of your choice.</p>
<p>If you have any questions about this process, please do not hesitate
and reach out but submitting an issue at the <a href="https://github.com/traitecoevo/infinitylists">infinitylists
repository</a>.</p>
<div id="load-dependencies" class="section level3">
<h3>Load dependencies</h3>
<p>We are going to need a few packages to create your own infinitylists.
Go ahead and install these if you don’t have these in your version of R.
Otherwise, load them and we can get started</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># install.packages(&quot;devtools&quot;)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;traitecoevo/infinitylists&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(infinitylists)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(galah)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>You will need to register for a <a href="https://www.gbif.org/">GBIF
account</a>. Click on the “Login” button on the top left corner and
click on the “Register” tab. Note down your login credentials for
safe-keeping once you have verified your account and created a
password.</p>
</div>
<div id="configure-galah" class="section level3">
<h3>Configure galah</h3>
<p>We will be using <a href="https://galah.ala.org.au/R/">{galah}</a> to
download occurrence records used our infinitylist. To do so, we need to
configure the settings so the package knows to point to the Global GBIF
API.</p>
<p>Here I’ve saved the credentials in my R environment so its not shared
publicly. I can call on these environment variables using
<code>Sys.getenv()</code>. You can also do so with
<code>usethis::edit_r_environ</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Set atlas</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">galah_config</span>(</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">atlas =</span> <span class="st">&quot;Global&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="at">username =</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;GBIF_USERNAME&quot;</span>),</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="at">password =</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;GBIF_PWD&quot;</span>),</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="at">email =</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;GBIF_EMAIL&quot;</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="submit-data-request" class="section level3">
<h3>Submit data request</h3>
<p>Once we have all that set up, we can request data from GBIF Global.
Here I am downloading records for the class <code>Arachnida</code>, from
years 2000 to 2004. Under <code>country_code</code>, I’ve specified
<code>&quot;FR&quot;</code> for records found in France. Here is a <a href="https://en.wikipedia.org/wiki/ISO_3166-2">list of codes</a> for
each country. The <code>download_gbif_obs</code> function will download
the records and say it internally inside the infinitylist R package so
you can use it immediately.</p>
<p>Note that depending on how many records are requested, the download
will take some time.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">download_gbif_obs</span>(<span class="st">&quot;Arachnida&quot;</span>,</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>                  <span class="at">min_year =</span> <span class="dv">2000</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>                  <span class="at">max_year =</span> <span class="dv">2024</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>                  <span class="at">country_code =</span> <span class="st">&quot;FR&quot;</span>)</span></code></pre></div>
</div>
<div id="pre-download-check" class="section level3">
<h3>Pre-download check</h3>
<p>You can check roughly how big your download is but using the
<code>query()</code> function with <code>galah::atlas_counts()</code>.
Note this will not be the find number of records that goes into
infinitylist as we do further exclusions and data cleaning behind the
scenes.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">query_gbif_global</span>(<span class="st">&quot;Arachnida&quot;</span>,</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>                  <span class="at">min_year =</span> <span class="dv">2000</span>,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>                  <span class="at">max_year =</span> <span class="dv">2024</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>                  <span class="at">country_code =</span> <span class="st">&quot;FR&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  galah<span class="sc">::</span><span class="fu">atlas_counts</span>()</span></code></pre></div>
<p>You can investigate the full download by specifying
<code>save_raw_data = TRUE</code> in
<code>download_gbif_obs()</code></p>
</div>
<div id="upload-your-own-kml" class="section level3">
<h3>Upload your own KML</h3>
<p>To make your viewing experience more flexible, we recommend uploading
a .KML. file of the country you downloaded data for. We downloaded the
outline of France <a href="https://cartographyvectors.com/map/260-france-outline">here</a>
and manually uploaded it to app using the “Upload KML” option.</p>
</div>
<div id="launch-infinitylist-and-explore" class="section level3">
<h3>Launch infinitylist and explore!</h3>
<p>Once the download is complete, you are all set! Launch infinitylist
and you will find your download under the dropdown menu “taxa”</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">infinitylistApp</span>()</span></code></pre></div>
</div>
<div id="open-downloaded-data" class="section level3">
<h3>Open downloaded data</h3>
<p>The following code identifies the file path of where your GBIF Global
records are downloaded if you want to open data in R or export it for
other uses. This is usually handy if you want to orientate the map to
where your download is from using <code>&quot;Choose a lat/long&quot;</code>.</p>
<p>In the next code chunk, replace <code>&quot;Arachnida&quot;</code> in the
<code>pattern</code> argument with the name of the taxa you have
downloaded data for in the previous step. This code will provide the
full file paths of objects that match the <code>pattern</code>
argument.</p>
<p>If you specified <code>save_raw_data = TRUE</code> in
<code>download_gbif_obs()</code>, this code will you two file paths. The
file with the prefix:</p>
<ul>
<li><code>&quot;GBIF-preprocessed-&quot;</code> is the raw download
<strong>before</strong> our data cleaning.</li>
<li><code>&quot;Living-Atlas-&quot;</code> is the final <strong>cleaned</strong>
download of the data you view in the app.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Locate file path of downloads</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&quot;infinitylists&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">file.path</span>(<span class="st">&quot;data&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">&quot;Arachnida&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>) <span class="co"># Match for Arachnida</span></span></code></pre></div>
<p>Copy the file path and pasted it in the <code>read_parquet()</code>
function to open the download in R.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>gbif_spiders <span class="ot">&lt;-</span> arrow<span class="sc">::</span><span class="fu">read_parquet</span>(<span class="st">&quot;infinitylists/inst/data/Living-Atlas-Arachnida-2024-10-16.parquet&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>gbif_spiders <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; # A tibble: 44,370 × 11</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt;    Species        Genus Family `Collection Date`   Lat   Long `Voucher Type` Repository `Recorded by`</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt;  * &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;      &lt;chr&gt;        </span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;  1 Phalangium op… Phal… Phala… 2024-04-19         48.8  2.42  Photograph     https://w… Titouan Gelez</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt;  2 Synema globos… Syne… Thomi… 2022-07-17         44.3  0.890 Photograph     https://w… Maël Richon  </span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt;  3 Salticus scen… Salt… Salti… 2021-05-27         48.0 -1.71  Photograph     https://w… Xavier HURIEZ</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt;  4 Alopecosa alb… Alop… Lycos… 2020-04-23         43.3  5.42  Photograph     https://w… Martin Galli </span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt;  5 Synema globos… Syne… Thomi… 2023-05-11         43.6  3.97  Photograph     https://w… Mike Hedde   </span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt;  6 Phalangium op… Phal… Phala… 2021-11-13         43.6  2.97  Photograph     https://w… Heikel B.    </span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt;  7 Philaeus chry… Phil… Salti… 2020-04-12         43.2  6.01  Photograph     https://w… Bernard Nogu…</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt;  8 Philaeus chry… Phil… Salti… 2021-04-07         43.2  6.01  Photograph     https://w… Bernard Nogu…</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt;  9 Trichoncoides… Tric… Linyp… 2024-02-08         43.4  5.18  Photograph     https://w… Julien Tchil…</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; 10 Lacinius horr… Laci… Phala… 2024-07-21         42.6  8.89  Photograph     https://w… Julien Botti…</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; # ℹ 44,360 more rows</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: `Establishment Means` &lt;lgl&gt;, Link &lt;chr&gt;</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
